{"data":{"css":".if-start, .if-mot-start{\n  display:none;\n  margin:10px;\n}\n\n.if-start-sel,.if-mot-start-sel{\n  display:flex;\n  flex-wrap:wrap;\n  justify-content:left;\n}\n\n.shortselect{\n  width:70px;\n  margin:10px;\n}\n\n.longselect{\n  width:300px;\n  margin-bottom:20px;\n}\n\n.sliderlabel{\n  color: #508c00;\n  font-size: 12px;\n}\n\n.if-mot-start-slide{\n  margin-top:-20px;\n}","data":[],"name":"dvr_settings","js":"var me = this; \nvar ME = $('#'+me.UUID)[0];\n\nif (ME.DATA.peer){\n  if (ME.DATA.peer != 'local') me.peer = ME.DATA.peer;\n}\nelse me.peer = typeof CURRENTDEVICEID == 'undefined' ? null : CURRENTDEVICEID;\n\n//me.peer = \"56ef9ae2-6fd9-40f7-8f46-0a3bcc711da5\";\n\nme.save = function(cb){\n  var start = $(ME).find('.dvrs-start').prop('checked');\n  var mot = $(ME).find('.dvrs-mot-start').prop('checked');\n  var res = me.resselect ? me.resselect.value().split('x') : [\"640\",\"480\"];\n  var rot = me.rotselect ? Number(me.rotselect.value()): 0;\n  var fps = me.fpsselect ? Number(me.fpsselect.value()) : 30;\n  var mod = me.modselect ? Number(me.modselect.value()) : 1;\n  var tolerance = ((Number($(ME).find('.rvs-sense').val())/55)-0.2) * -1;\n  var factor = Number($(ME).find('.rvs-noise').val()) / 2;\n  \n  var d = {\n    \"start\": start,\n    \"motion-detection\": mot,\n    \"width\": Number(res[0]),\n    \"height\": Number(res[1]),\n    \"rotation\": rot,\n    \"fps\": fps,\n    \"modulus\": mod,\n    \"motion-tolerance\": tolerance,\n    \"noise-factor\": factor\n  };\n  send_save(d, cb, me.peer);\n};\n\nme.ready = function(){\n  var iss = $(ME).find('.if-start-sel');\n  send_info(function(result){\n    me.data = result.data ? result.data : {\n      \"start\": false,\n      \"width\": 640,\n      \"height\": 480,\n      \"rotation\": 0,\n      \"fps\": 10,\n      \"motion-modulus\": 1,\n      \"motion-detection\": \"false\"\n    };\n\n    var b = me.data.start == 'true';\n    $(ME).find('.dvrs-start').prop('checked', b);\n    $(ME).find('.if-start').css('display', b ? 'block' : 'none');\n    \n    var w = me.data.width;\n    var h = me.data.height;\n    var r = w+'x'+h;\n    \n    var d = {\n      \"label\": \"Resolution\",\n      \"list\": [ \"1920x1080\", \"1280x720\", \"800x600\", \"640x480\", \"480x360\", \"320x240\", \"240x180\" ],\n      \"value\": r\n    };\n    var el = $('<div class=\"shortselect\"/>');\n    $(ME).find('.if-start-sel').append(el);\n    installControl(el[0], 'metabot', 'select', function(api){ me.resselect = api; }, d);\n\n    var rot = me.data.rotation;\n    d = {\n      \"label\": \"Rotation\",\n      \"list\": [ \"0\", \"90\", \"180\", \"270\" ],\n      \"value\": rot\n    };\n    el = $('<div class=\"shortselect\"/>');\n    $(ME).find('.if-start-sel').append(el);\n    installControl(el[0], 'metabot', 'select', function(api){ me.rotselect = api; }, d);\n    \n    var fps = me.data.fps;\n    d = {\n      \"label\": \"Framerate\",\n      \"list\": [ \"5\", \"10\", \"15\", \"20\", \"25\", \"30\" ],\n      \"value\": fps\n    };\n    el = $('<div class=\"shortselect\"/>');\n    $(ME).find('.if-start-sel').append(el);\n    installControl(el[0], 'metabot', 'select', function(api){ me.fpsselect = api; }, d);\n\n    var mod = me.data['motion-modulus'];\n    d = {\n      \"label\": \"Samples per minute\",\n      \"list\": [ \n        { \"id\": \"5\", \"name\": \"6\" },\n        { \"id\": \"4\", \"name\": \"7.5\" },\n        { \"id\": \"3\", \"name\": \"10\" },\n        { \"id\": \"2\", \"name\": \"15\" },\n        { \"id\": \"1\", \"name\": \"30\" }\n      ],\n      \"value\": mod\n    };\n    el = $('<div class=\"longselect\"/>');\n    $(ME).find('.if-mot-start-sel').append(el);\n    installControl(el[0], 'metabot', 'select', function(api){ me.modselect = api; }, d);\n\n    b = me.data['motion-detection'] == 'true';\n    $(ME).find('.dvrs-mot-start').prop('checked', b);\n    $(ME).find('.if-mot-start').css('display', b ? 'block' : 'none');\n\n    var mt = me.data['motion-tolerance'] ? me.data['motion-tolerance'] : 0;\n    var nf = me.data['noise-factor'] ? me.data['noise-factor'] : 0;\n    var sense = (0.2 - mt) * 55;\n    var noise = nf * 2;\n    $(ME).find('.rvs-sense').val(sense);\n    $(ME).find('.rvs-noise').val(noise);\n    \n    $(ME).find('.rvs-sense')[0].Material\n    \n    componentHandler.upgradeAllRegistered();\n    \n    $(ME).find('.dvrs-start').parent()[0].MaterialSwitch.checkToggleState();\n    $(ME).find('.dvrs-mot-start').parent()[0].MaterialSwitch.checkToggleState();\n    $(ME).find('.rvs-sense')[0].MaterialSlider.change();\n    $(ME).find('.rvs-noise')[0].MaterialSlider.change();\n  }, me.peer);\n};\n\n$(document).click(function(event) {\n   window.lastElementClicked = event.target;\n});\n\n$(ME).find('.dvrs-start').change(function(){\n  var b = $(this).prop('checked');\n  $(ME).find('.if-start').css('display', b ? 'block' : 'none');\n});\n\n$(ME).find('.dvrs-mot-start').change(function(){\n  var b = $(this).prop('checked');\n  $(ME).find('.if-mot-start').css('display', b ? 'block' : 'none');\n});","groups":"anonymous","ctl":"zvltxr175ae6c20e4z1bc","html":"<label class=\"mdl-switch mdl-js-switch mdl-js-ripple-effect\" for=\"dvrs-start\">\n  <input type=\"checkbox\" id=\"dvrs-start\" class=\"mdl-switch__input dvrs-start\">\n  <span class=\"mdl-switch__label\">Capture Video<\/span>\n<\/label>\n<div class='if-start'>\n  <div class='if-start-sel'><\/div>\n  <label class=\"mdl-switch mdl-js-switch mdl-js-ripple-effect\" for=\"dvrs-mot-start\">\n    <input type=\"checkbox\" id=\"dvrs-mot-start\" class=\"mdl-switch__input dvrs-mot-start\">\n    <span class=\"mdl-switch__label\">Detect Motion<\/span>\n  <\/label>\n  <div class='if-mot-start'>\n    <div class='if-mot-start-sel'><\/div>\n    <div class=\"if-mot-start-slide\">\n      <div class='longselect'>\n        <div class='sliderlabel'>Sensitivity<\/div>\n        <input class=\"mdl-slider mdl-js-slider rvs-sense\" type=\"range\"  min=\"0\" max=\"11\" value=\"0\" tabindex=\"0\">\n      <\/div>\n      <div class='longselect'>\n        <div class='sliderlabel'>Noise Cancellation<\/div>\n        <input class=\"mdl-slider mdl-js-slider rvs-noise\" type=\"range\"  min=\"0\" max=\"11\" value=\"0\" tabindex=\"0\">\n      <\/div>\n    <\/div>\n  <\/div>\n<\/div>","cmd":[{"java":"mwrwjp175ae6d86car1da","name":"info","id":"lrlztp175ae6d86cex1db"},{"java":"kohzgx175ae6e682ez1f1","name":"save","id":"lymgpq175ae6e6832v1f2"}],"three":{"controls":[]},"db":"raspberrypi","desc":""},"readers":["anonymous"],"id":"zvltxr175ae6c20e4z1bc","sessionid":"jvgvwg16b7a4d277bt3","time":1618944511586,"addr":"/0:0:0:0:0:0:0:1:35764","username":"admin"}