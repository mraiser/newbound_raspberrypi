{"data":{"timer":[{"name":"init","id":"qogghm175ae666a75n13d"}],"css":".timestamp{\n  position:absolute;\n  bottom:40px;\n  right:40px;\n  color: #83bc00;\n  font-weight:900;\n  text-shadow:\n     -1px -1px 0 #000,  \n      1px -1px 0 #000,\n      -1px 1px 0 #000,\n       1px 1px 0 #000;\n}","data":[],"name":"cameramodule","js":"var me = this;\nvar ME = $('#'+me.UUID)[0];\n\nif (ME.DATA.peer){\n  if (ME.DATA.peer != 'local') me.peer = ME.DATA.peer;\n}\nelse me.peer = typeof CURRENTDEVICEID == 'undefined' ? null : CURRENTDEVICEID;\n\n//me.peer = \"56ef9ae2-6fd9-40f7-8f46-0a3bcc711da5\";\n//ME.DATA.update = 3000;\n\nme.prefix = me.peer ? '../peerbot/remote/'+me.peer+'/' : '../';\n\nme.ready = function(){\n  json(me.prefix+'metabot/call', 'db=raspberrypi&name=cameramodule&cmd=info&args={}', function(result){\n    me.info = result.data;\n    if (!me.info || !me.info.last){\n      var url = '../botmanager/asset/raspberrypi/nosignal.jpg';\n      $(ME).find('.live').prop('src', url);\n    }\n    else{\n      var stop = me.info.last.time;\n      me.delta = new Date().getTime() - stop;\n      loadSnap(stop, updateLive, 3000);\n    }\n  });\n};\n\nvar fortyeighthours = 1000 * 60 * 60 * 48;\nfunction updateLive(){\n  if (document.getElementById(me.UUID) == ME){\n    var stop = new Date().getTime() - me.delta;\n    me.info.last.time = stop;\n    me.info.first.time = Math.max(me.info.first.time, stop - fortyeighthours);\n    if (ME.DATA.update) loadSnap(stop, updateLive, ME.DATA.update);\n    else setTimeout(updateLive, 3000);\n  }\n}\nme.updateLive = updateLive;\n\nfunction loadSnap(stop, cb, millis, override){\n  var url = previewPath(stop);\n  var el = $(\"<img style='display:none;'/>\");\n  $(ME).append(el);\n  el.load(function(){\n    if (ME.DATA.update || override){\n      $(ME).find('.live').prop('src', url);\n      $(ME).find('.timestamp').text(parseTime(new Date(stop)));\n      $('.overimage').css('display', 'none');\n    }\n    el.remove();\n    if (cb) setTimeout(cb, millis);\n  });\n  el[0].src = url;\n}\nme.loadSnap = loadSnap;\n\nfunction previewPath(time){\n  var s = me.prefix+'metabot/call?db=raspberrypi&name=cameramodule&cmd=jpeg&args='+JSON.stringify({time:time});\n  console.log(s);\n  return s;\n}\nme.previewPath = previewPath;\n\nfunction parseTime(d){\n  return parseDate(d)+':'+padZero(d.getSeconds());\n}\n","groups":"camera","ctl":"gopmqw175ae5ec543r84","html":"<div style='position:relative;display:inline-block;'>\n  <img class='live' src='../botmanager/asset/raspberrypi/loading640.gif'>\n  <div class='timestamp'><\/div>\n<\/div>\n","cmd":[{"java":"hjuurn175ae5faa61p97","name":"init","id":"gvltvv175ae5faa67o98"},{"java":"tvnmqv175ae60a084oae","name":"jpeg","id":"qymltm175ae60a088paf"},{"java":"vuqkqn175ae6186cdvc5","name":"info","id":"oypnsm175ae6186d2uc6"},{"java":"nlsrsj175ae62780bxdd","name":"events","id":"lugoln175ae627811hde"},{"java":"xsoygz175ae639fbfqfa","name":"build","id":"xmymnh175ae639fc5zfb"},{"java":"jghtgm175ae65778ap125","name":"timelapse","id":"mkpuxn175ae657793v126"}],"three":{"controls":[]},"db":"raspberrypi","desc":""},"readers":["camera"],"id":"gopmqw175ae5ec543r84","sessionid":"jvgvwg16b7a4d277bt3","time":1604953867223,"addr":"/0:0:0:0:0:0:0:1:59008","username":"admin"}