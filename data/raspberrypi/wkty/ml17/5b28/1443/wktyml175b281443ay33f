{"data":{"css":"canvas {\n  width: 100%;\n  height: 100%;\n}","data":[],"name":"powerbutton","js":"var me = this;\nvar ME = $('#'+me.UUID)[0];\n\nCURRENTDEVICEPREFIX = typeof CURRENTDEVICEPREFIX == 'undefined' ? '../' : CURRENTDEVICEPREFIX;\n\nvar data = me.data = $(ME).data('control');\nvar canvas = me.canvas = $(ME).find('canvas')[0];\nvar ctx = me.ctx = canvas.getContext('2d');\n\nvar prefix = !data.peer ? CURRENTDEVICEPREFIX : data.peer == 'local' ? '../' : '../peerbot/remote/'+data.peer+'/';\n\nme.ready = function(){\n  me.data.title = me.data.title ? me.data.title : '';\n  me.redraw();\n  \n  $(canvas).hover(function(x){ hover(x); });\n  $(canvas).click(data.click);\n};\n\nfunction hover(x){\n  me.hover = x.type == 'mouseenter';\n  me.redraw();\n}\n\nme.redraw = function(){\n  var w = $(ME).width();\n  var h = $(ME).height();\n  \n  var L = Math.min(w,h);\n  var offx = (w-L)/2;\n  var offy = (h-L)/2;\n  \n  var fontsize = 18*L/150;\n  var stroke1 = 15*L/150;\n  var stroke2 = 2*L/150;\n\n  var h3 = 130*L/150;\n\n  canvas.width = w;\n  canvas.height = h;\n  \n  ctx.lineWidth = stroke1;\n  ctx.strokeStyle = data.value == -1 ? '#000000' : data.value > 0 ? (me.hover ? '#4bbb2a' : '#4bff2a') : (me.hover ? '#4b8c2a' : '#264616');\n  ctx.fillStyle = data.value == -1 ? '#000000' : ctx.strokeStyle;\n  \n  var delta = 0.14;\n  var off = L * delta;\n  var bw = L * (1-delta*2);\n  var radius = bw * 0.40;\n  var stroke = bw / 10;\n\n  var rs = radius + stroke + off;\n\n  ctx.beginPath();\n  ctx.arc(rs+offx, rs-off/2, radius, -0.4 * Math.PI , 1.4 * Math.PI, false);\n  ctx.lineWidth = stroke;\n  ctx.stroke();\n  ctx.fillRect(radius + (stroke/2)+off+offx, off/2, stroke, rs);\n  \n  ctx.font = fontsize+\"px Arial\";\n  ctx.fillStyle = '#fff';\n  ctx.lineWidth = stroke2;\n  ctx.strokeStyle = '#000';\n  ctx.textAlign = 'center';\n  ctx.shadowColor = 'black';\n\n  ctx.strokeText(me.data.title,w/2,h3);\n  ctx.fillText(me.data.title,w/2,h3);\n};\n\nme.update = function(d){\n  console.log('setting state to '+d);\n  me.data.value = d;\n  me.redraw();\n};\n","groups":"anonymous","ctl":"wktyml175b281443ay33f","html":"<canvas />","three":{"controls":[]},"db":"raspberrypi","desc":""},"readers":["anonymous"],"id":"wktyml175b281443ay33f","sessionid":"jvgvwg16b7a4d277bt3","time":1605017651976,"addr":"/0:0:0:0:0:0:0:1:40762","username":"admin"}