{"data":{"timer":[{"name":"log","id":"risgtj175ae79e985p2f2"}],"css":".dialgoeshere{\n  width:140px;\n  height:140px;\n  display:inline-block;\n}\n\n.sensorgraph{\n  display: none;\n  position: fixed;\n  top:0px;\n  left:0px;\n  bottom:0px;\n  right:0px;\n  overflow: hidden;\n  background-color: #000a;\n}\n\n.selectoffset{\n  position: absolute;\n  top:80px;\n}","data":[],"name":"cpu","js":"var me = this;\nvar ME = $('#'+me.UUID)[0];\n\nme.data = {};\n\nif (ME.DATA.peer){\n  if (ME.DATA.peer != 'local') me.peer = ME.DATA.peer;\n}\nelse me.peer = typeof CURRENTDEVICEID == 'undefined' ? null : CURRENTDEVICEID;\n\nme.ready = function(){\n  componentHandler.upgradeAllRegistered();\n  var el = $('<div class=\"raspi_cpuinfo iconmode\"/>');\n  updateDial(el);\n  $(ME).find('.closegraphbutton').click(hideGraph); \n  $(ME).find('.dialgoeshere').click(showGraph); \n  $(ME).find('.plotdur').change(showGraph);\n};\n\nfunction updateDial(el){\n  if ($(document).find(ME)[0]) send_usage(function(result){\n    var p = result.data.value*100;\n    if (!$(ME).find(el[0])[0]){\n      $(ME).find('.dialgoeshere').html(el);\n      var title = ME.DATA.title ? ME.DATA.title : \"CPU Used\";\n      var d = {\n        value: p.toFixed(1),\n        units: '%',\n        title: title,\n        range: [0,100]\n      };\n      installControl(el[0], \"metabot\", \"dial\", function(api){\n        setTimeout(function(){\n          updateDial(el, false);\n        }, 3000);\n      }, d);\n    }\n    else {\n      var api = el[0].api;\n      api.update(p.toFixed(1));\n      setTimeout(function(){\n        updateDial(el);\n      }, 3000);\n    }  \n  }, me.peer);\n}\n\nfunction hideGraph(){\n  $(ME).find('.sensorgraph').css('display', 'none');\n}\n\nfunction showGraph(){\n  \n  var days = Number($(ME).find('.sensorgraph').find('select').val());\n  if (!me.timeoffset) me.timeoffset = 0;\n  \n  $(ME).find('.sensorgraph').css('display', 'block');\n//  $(ME).removeClass('iconmode');\n//  $(ME).find('.sensorgraph').addClass('fullscreenmode');\n  \n  var d = new Date();\n  var end = d.getTime() + me.timeoffset;\n  var start = end - (1000 * 60 * 60 * 24 * days);\n  var stop = end  + 5000;\n  var mod = Math.max(1, Math.floor((stop - start) / (60 * 60 * 1000)));\n    \n  console.log(d.getTime());\n  console.log(me.timeoffset);\n\n  $(window).resize();\n  \n  var labels = [];\n  var datasets = [{\n    fill: true,\n    backgroundColor: \"rgba(75,140,42,0.2)\",\n    borderColor: \"rgba(75,140,42,1)\",\n    pointBackgroundColor: \"rgba(75,140,42,0.5)\",\n    pointBorderColor: \"#fff\",\n    data: []\n  }];\n  \n  me.chartdata = {\n    labels: labels,\n    datasets: datasets\n  };\n  \n  drawChart(me.chartdata);\n\n  \n  send_getlogdata(start, stop, mod, function(result){\n    if (result.status != 'ok'){\n      //showGraph();\n      alert(result.msg);\n    }\n    else {\n  //    console.log(result);\n      \n      for (var i=0;i<result.data.list.length;i++) {\n        if (i%5 == 0) \n          labels.push(parseDate(new Date(result.data.list[i][0])));\n        else labels.push('');\n        datasets[0].data.push(recalculate(result.data.list[i][1]));\n  //      console.log(result.data.list[i]);\n      }\n  \n      me.chartdata = {\n          labels: labels,\n          datasets: datasets\n      };\n      \n      drawChart(me.chartdata);\n    }\n  }, me.peer);\n  \n}\n\nfunction drawChart(data){\n  var el = $(ME).find('.cpugraphctl')[0];\n  installControl(el, 'raspberrypi', 'linegraph', function(api){}, data);\n}\n\nfunction recalculate(val){\n//  var d = me.data.calibration;\n//  var b = (d[1][1] - d[0][1]) / (d[1][0] - d[0][0]);\n//  var a = (0-d[0][0])*b+d[0][1];\n//  val = (val * b + a);\n//  return val.toFixed(1);\n  console.log(val);\n  return parseFloat(val);\n}\n\n$(document).click(function(event) {\n   window.lastElementClicked = event.target;\n});\n","groups":"trusted","ctl":"vrrnpt175ae714086z230","html":"<div class='dialgoeshere'><img src='../botmanager/asset/raspberrypi/loading_trippy.gif'><\/div>\n<div class='sensorgraph'>\n  <div class='selectoffset'>\n    <button class=\"mdl-button mdl-js-button mdl-button--fab mdl-button--mini-fab mdl-button--colored closegraphbutton\">\n      <i class=\"material-icons\">close<\/i>\n    <\/button>\n    <select class=\"plotdur\"><option value=\"0.05\">1 Hour<\/option><option value=\"0.1\">2 Hours<\/option><option value=\"0.25\">6 Hours<\/option><option value=\"0.5\">12 Hours<\/option><option value=\"1\" selected>24 Hours<\/option><option value=\"2\">48 Hours<\/option><option value=\"7\">1 Week<\/option><option value=\"30\">1 Month<\/option><option value=\"91\">3 Months<\/option><option value=\"182\">6 Months<\/option><option value=\"365\">1 Year<\/option><\/select>\n  <\/div>\n  <div class='cpugraphctl'/>\n<\/div>\n","cmd":[{"java":"zvknjr175ae736e4fq261","name":"usage","id":"sxzwwt175ae736e52n262"},{"java":"glzhhj175ae7733eey2b4","name":"log","id":"roqrwv175ae7733f1h2b5"},{"java":"qoxgko175ae78cbf0q2d7","name":"getlogdata","id":"kvmrhz175ae78cbf4w2d8"}],"three":{"controls":[]},"db":"raspberrypi","desc":""},"readers":["trusted"],"id":"vrrnpt175ae714086z230","sessionid":"jvgvwg16b7a4d277bt3","time":1604950026640,"addr":"/0:0:0:0:0:0:0:1:55862","username":"admin"}